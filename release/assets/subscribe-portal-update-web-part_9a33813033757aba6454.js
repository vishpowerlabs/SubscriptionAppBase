define("b6e1781d-7b91-48f8-aa1e-3bafe48cd49d_0.0.1",["@microsoft/sp-core-library","@microsoft/sp-webpart-base","@microsoft/sp-http","@microsoft/sp-lodash-subset"],(e,t,n,a)=>(()=>{"use strict";var i={52:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a,i,r=function(){return r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};!function(e){e[e.sync=0]="sync",e[e.async=1]="async"}(a||(a={})),function(e){e[e.onlyThemable=1]="onlyThemable",e[e.onlyNonThemable=2]="onlyNonThemable",e[e.all=3]="all"}(i||(i={}));var o,s,c,d="undefined"==typeof window?n.g:window,l=d&&d.CSPSettings&&d.CSPSettings.nonce,u=((c=d.__themeState__||{theme:void 0,lastStyleElement:void 0,registeredStyles:[]}).runState||(c=r(r({},c),{perf:{count:0,duration:0},runState:{flushTimer:0,mode:a.sync,buffer:[]}})),c.registeredThemableStyles||(c=r(r({},c),{registeredThemableStyles:[]})),d.__themeState__=c,c),f=/[\'\"]\[theme:\s*(\w+)\s*(?:\,\s*default:\s*([\\"\']?[\.\,\(\)\#\-\s\w]*[\.\,\(\)\#\-\w][\"\']?))?\s*\][\'\"]/g,p=function(){return"undefined"!=typeof performance&&performance.now?performance.now():Date.now()};function m(e){var t=p();e();var n=p();u.perf.duration+=n-t}function _(e,t){u.loadStyles?u.loadStyles(h(e).styleString,e):function(e){if("undefined"!=typeof document){var t=document.getElementsByTagName("head")[0],n=document.createElement("style"),a=h(e),i=a.styleString,r=a.themable;n.setAttribute("data-load-themed-styles","true"),l&&n.setAttribute("nonce",l),n.appendChild(document.createTextNode(i)),u.perf.count++,t.appendChild(n);var o=document.createEvent("HTMLEvents");o.initEvent("styleinsert",!0,!1),o.args={newStyle:n},document.dispatchEvent(o);var s={styleElement:n,themableStyle:e};r?u.registeredThemableStyles.push(s):u.registeredStyles.push(s)}}(e)}function h(e){var t=u.theme,n=!1;return{styleString:(e||[]).map(function(e){var a=e.theme;if(a){n=!0;var i=t?t[a]:void 0,r=e.defaultValue||"inherit";return t&&!i&&console,i||r}return e.rawString}).join(""),themable:n}}o='.subscribePortalUpdate_42f44968{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;margin:0 auto;max-width:600px;padding:24px}.subscribePortalUpdate_42f44968 *{box-sizing:border-box}.subscribePortalUpdate_42f44968 .alert_42f44968{align-items:center;animation:slideDown_42f44968 .3s ease-out;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);display:flex;font-size:14px;font-weight:500;justify-content:space-between;margin-bottom:24px;padding:16px 20px}.subscribePortalUpdate_42f44968 .alertSuccess_42f44968{background:linear-gradient(135deg,#d4edda,#c3e6cb);border:1px solid #b1dfbb;color:#155724}.subscribePortalUpdate_42f44968 .alertError_42f44968{background:linear-gradient(135deg,#f8d7da,#f1c2c7);border:1px solid #e4b3ba;color:#721c24}.subscribePortalUpdate_42f44968 .alertContent_42f44968{align-items:center;display:flex;flex:1;gap:12px}.subscribePortalUpdate_42f44968 .alertIcon_42f44968{align-items:center;display:flex;flex-shrink:0;height:24px;justify-content:center;width:24px}.subscribePortalUpdate_42f44968 .alertIcon_42f44968 svg{height:18px;width:18px}.subscribePortalUpdate_42f44968 .alertMessage_42f44968{flex:1;line-height:1.5}.subscribePortalUpdate_42f44968 .alertClose_42f44968{align-items:center;background:0 0;border:none;border-radius:4px;color:inherit;cursor:pointer;display:flex;flex-shrink:0;height:24px;justify-content:center;opacity:.7;padding:4px;transition:all .2s ease;width:24px}.subscribePortalUpdate_42f44968 .alertClose_42f44968 svg{height:16px;width:16px}.subscribePortalUpdate_42f44968 .alertClose_42f44968:hover{background:rgba(0,0,0,.1);opacity:1}.subscribePortalUpdate_42f44968 .alertClose_42f44968:active{transform:scale(.95)}.subscribePortalUpdate_42f44968 .card_42f44968{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.04),0 8px 24px rgba(0,0,0,.08);overflow:hidden;transition:all .3s ease}.subscribePortalUpdate_42f44968 .card_42f44968:hover{box-shadow:0 4px 12px rgba(0,0,0,.06),0 12px 32px rgba(0,0,0,.12);transform:translateY(-2px)}.subscribePortalUpdate_42f44968 .cardHeader_42f44968{align-items:flex-start;background:linear-gradient(135deg,#f8f9fa,#fff);border-bottom:1px solid rgba(0,0,0,.06);display:flex;gap:20px;padding:28px 32px}.subscribePortalUpdate_42f44968 .iconWrapper_42f44968{align-items:center;background:linear-gradient(135deg,#0078d4,#106ebe);border-radius:14px;box-shadow:0 4px 12px rgba(0,120,212,.25),inset 0 -2px 8px rgba(0,0,0,.1);color:#fff;display:flex;flex-shrink:0;height:56px;justify-content:center;width:56px}.subscribePortalUpdate_42f44968 .iconWrapper_42f44968 svg{filter:drop-shadow(0 2px 4px rgba(0,0,0,.15))}.subscribePortalUpdate_42f44968 .headerContent_42f44968{flex:1;min-width:0}.subscribePortalUpdate_42f44968 .title_42f44968{color:#1a1a1a;font-size:22px;font-weight:600;letter-spacing:-.02em;line-height:1.3;margin:0 0 8px}.subscribePortalUpdate_42f44968 .description_42f44968{color:#666;font-size:14px;font-weight:400;line-height:1.6;margin:0}.subscribePortalUpdate_42f44968 .cardBody_42f44968{display:flex;flex-direction:column;gap:20px;padding:28px 32px}.subscribePortalUpdate_42f44968 .statusBadge_42f44968{align-items:center;align-self:flex-start;border-radius:8px;display:inline-flex;font-size:13px;font-weight:600;gap:8px;letter-spacing:.02em;padding:10px 16px}.subscribePortalUpdate_42f44968 .statusActive_42f44968{background:linear-gradient(135deg,#d4edda,#c3e6cb);border:1px solid #b1dfbb;color:#155724}.subscribePortalUpdate_42f44968 .statusActive_42f44968 svg{height:16px;width:16px}.subscribePortalUpdate_42f44968 .button_42f44968{align-items:center;border:none;border-radius:10px;cursor:pointer;display:flex;font-family:inherit;font-size:15px;font-weight:600;gap:10px;justify-content:center;letter-spacing:.01em;overflow:hidden;padding:14px 28px;position:relative;transition:all .2s ease;width:100%}.subscribePortalUpdate_42f44968 .button_42f44968:before{background:hsla(0,0%,100%,.2);border-radius:50%;content:"";height:0;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);transition:width .6s,height .6s;width:0}.subscribePortalUpdate_42f44968 .button_42f44968:hover:before{height:300px;width:300px}.subscribePortalUpdate_42f44968 .button_42f44968:active{transform:scale(.98)}.subscribePortalUpdate_42f44968 .button_42f44968:disabled{cursor:not-allowed;opacity:.6;transform:none}.subscribePortalUpdate_42f44968 .button_42f44968:disabled:hover:before{height:0;width:0}.subscribePortalUpdate_42f44968 .button_42f44968:focus-visible{outline:3px solid rgba(0,120,212,.4);outline-offset:2px}.subscribePortalUpdate_42f44968 .buttonPrimary_42f44968{background:linear-gradient(135deg,#0078d4,#106ebe);box-shadow:0 2px 8px rgba(0,120,212,.3),0 4px 16px rgba(0,120,212,.2);color:#fff}.subscribePortalUpdate_42f44968 .buttonPrimary_42f44968:hover:not(:disabled){background:linear-gradient(135deg,#106ebe,#005a9e);box-shadow:0 4px 12px rgba(0,120,212,.4),0 6px 20px rgba(0,120,212,.3);transform:translateY(-2px)}.subscribePortalUpdate_42f44968 .buttonSecondary_42f44968{background:linear-gradient(135deg,#fff,#f8f9fa);border:2px solid #d1d1d1;box-shadow:0 2px 6px rgba(0,0,0,.08);color:#323130}.subscribePortalUpdate_42f44968 .buttonSecondary_42f44968:hover:not(:disabled){background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-color:#106ebe;box-shadow:0 4px 12px rgba(0,0,0,.12),0 0 0 1px rgba(16,110,190,.2);color:#106ebe;transform:translateY(-2px)}.subscribePortalUpdate_42f44968 .buttonText_42f44968{position:relative;z-index:1}.subscribePortalUpdate_42f44968 .spinner_42f44968{animation:spin_42f44968 .8s linear infinite;border:3px solid hsla(0,0%,100%,.3);border-radius:50%;border-top-color:#fff;display:inline-block;height:18px;position:relative;width:18px;z-index:1}.subscribePortalUpdate_42f44968 .icon_42f44968{stroke-width:2.5;height:28px;width:28px}.subscribePortalUpdate_42f44968 .iconSmall_42f44968{stroke-width:3;height:16px;width:16px}.subscribePortalUpdate_42f44968 .hidden_42f44968{display:none}@keyframes slideDown_42f44968{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes spin_42f44968{to{transform:rotate(1turn)}}@media (max-width:640px){.subscribePortalUpdate_42f44968{padding:16px}.subscribePortalUpdate_42f44968 .cardHeader_42f44968{gap:16px;padding:20px}.subscribePortalUpdate_42f44968 .iconWrapper_42f44968{border-radius:12px;height:48px;width:48px}.subscribePortalUpdate_42f44968 .icon_42f44968{height:24px;width:24px}.subscribePortalUpdate_42f44968 .title_42f44968{font-size:19px}.subscribePortalUpdate_42f44968 .description_42f44968{font-size:13px}.subscribePortalUpdate_42f44968 .cardBody_42f44968{padding:20px}.subscribePortalUpdate_42f44968 .button_42f44968{font-size:14px;padding:12px 24px}.subscribePortalUpdate_42f44968 .alert_42f44968{font-size:13px;padding:12px 16px}}@media (max-width:480px){.subscribePortalUpdate_42f44968 .cardHeader_42f44968{align-items:center;flex-direction:column;text-align:center}.subscribePortalUpdate_42f44968 .headerContent_42f44968{text-align:center}}@media (prefers-color-scheme:dark){.subscribePortalUpdate_42f44968 .card_42f44968{background:#1e1e1e;border-color:hsla(0,0%,100%,.1)}.subscribePortalUpdate_42f44968 .cardHeader_42f44968{background:linear-gradient(135deg,#2a2a2a,#1e1e1e);border-bottom-color:hsla(0,0%,100%,.1)}.subscribePortalUpdate_42f44968 .title_42f44968{color:#fff}.subscribePortalUpdate_42f44968 .description_42f44968{color:#b3b3b3}.subscribePortalUpdate_42f44968 .buttonSecondary_42f44968{background:linear-gradient(135deg,#2a2a2a,#1e1e1e);border-color:#4a4a4a;color:#fff}.subscribePortalUpdate_42f44968 .buttonSecondary_42f44968:hover:not(:disabled){background:linear-gradient(135deg,#3a3a3a,#2a2a2a);border-color:#0078d4}}@media print{.subscribePortalUpdate_42f44968 .alert_42f44968,.subscribePortalUpdate_42f44968 .button_42f44968{display:none}.subscribePortalUpdate_42f44968 .card_42f44968{border:1px solid #000;box-shadow:none}}@media (prefers-reduced-motion:reduce){.subscribePortalUpdate_42f44968 *,.subscribePortalUpdate_42f44968 :after,.subscribePortalUpdate_42f44968 :before{animation-duration:0s!important;animation-iteration-count:1!important;transition-duration:0s!important}}@media (prefers-contrast:high){.subscribePortalUpdate_42f44968 .button_42f44968,.subscribePortalUpdate_42f44968 .card_42f44968{border:2px solid}}',void 0===(s=!0)&&(s=!1),m(function(){var e=Array.isArray(o)?o:function(e){var t=[];if(e){for(var n=0,a=void 0;a=f.exec(e);){var i=a.index;i>n&&t.push({rawString:e.substring(n,i)}),t.push({theme:a[1],defaultValue:a[2]}),n=f.lastIndex}t.push({rawString:e.substring(n)})}return t}(o),t=u.runState,n=t.mode,i=t.buffer,r=t.flushTimer;s||n===a.async?(i.push(e),r||(u.runState.flushTimer=self.setTimeout(function(){u.runState.flushTimer=0,m(function(){var e=u.runState.buffer.slice();u.runState.buffer=[];var t=[].concat.apply([],e);t.length>0&&_(t)})},0))):_(e)});const b={subscribePortalUpdate_42f44968:"subscribePortalUpdate_42f44968",alert_42f44968:"alert_42f44968",slideDown_42f44968:"slideDown_42f44968",alertSuccess_42f44968:"alertSuccess_42f44968",alertError_42f44968:"alertError_42f44968",alertContent_42f44968:"alertContent_42f44968",alertIcon_42f44968:"alertIcon_42f44968",alertMessage_42f44968:"alertMessage_42f44968",alertClose_42f44968:"alertClose_42f44968",card_42f44968:"card_42f44968",cardHeader_42f44968:"cardHeader_42f44968",iconWrapper_42f44968:"iconWrapper_42f44968",headerContent_42f44968:"headerContent_42f44968",title_42f44968:"title_42f44968",description_42f44968:"description_42f44968",cardBody_42f44968:"cardBody_42f44968",statusBadge_42f44968:"statusBadge_42f44968",statusActive_42f44968:"statusActive_42f44968",button_42f44968:"button_42f44968",buttonPrimary_42f44968:"buttonPrimary_42f44968",buttonSecondary_42f44968:"buttonSecondary_42f44968",buttonText_42f44968:"buttonText_42f44968",spinner_42f44968:"spinner_42f44968",spin_42f44968:"spin_42f44968",icon_42f44968:"icon_42f44968",iconSmall_42f44968:"iconSmall_42f44968",hidden_42f44968:"hidden_42f44968"}}
,676:t=>{t.exports=e},909:e=>{e.exports=n},529:e=>{e.exports=a},642:e=>{e.exports=t}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return i[e](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{o.r(s),o.d(s,{default:()=>u});var e=o(676),t=o(642),n=o(909);o(52);const a="icon_42f44968";var i,r=o(529),c=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),d=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((a=a.apply(e,t||[])).next())})},l=function(e,t){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&s[0]?a.return:s[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;switch(a=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,a=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],a=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};const u=function(i){function o(){var e=null!==i&&i.apply(this,arguments)||this;return e._isSubscribed=!1,e._isLoading=!1,e._statusMessage="",e._statusType="",e._currentUserEmail="",e._alreadyInitialized=!1,e._productNameOptions=[],e._productNameOptionsLoaded=!1,e}return c(o,i),o.prototype._ensureDefaultProperties=function(){this.properties.ListName&&0!==this.properties.ListName.trim().length||(this.properties.ListName="subscriptionlist"),this.properties.PrefixText&&0!==this.properties.PrefixText.trim().length||(this.properties.PrefixText="Subscribe to"),this.properties.SuffixText&&0!==this.properties.SuffixText.trim().length||(this.properties.SuffixText="updates"),this.properties.ProductNameColumnName&&0!==this.properties.ProductNameColumnName.trim().length||(this.properties.ProductNameColumnName="SubscribedFor")},o.prototype._logDebug=function(e,t){console.log("[SubscribePortalUpdate] ".concat(e),null!=t?t:"")},o.prototype.onInit=function(){return d(this,void 0,void 0,function(){return l(this,function(e){return this._ensureDefaultProperties(),this._logDebug("onInit",{listName:this.properties.ListName,productName:this.properties.ProductName}),[2,i.prototype.onInit.call(this)]})})},o.prototype.render=function(){this._ensureDefaultProperties(),this.domElement.innerHTML=this._getHtml(),this._wireEvents(),this._alreadyInitialized||(this._alreadyInitialized=!0,this._loadInitialStatus())},o.prototype._loadInitialStatus=function(){return d(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,4,5]),this._setLoading(!0),[4,this._ensureUserEmail()];case 1:return t.sent(),[4,this._checkSubscription()];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),this._showError("Error checking subscription status: "+(null==e?void 0:e.message)),[3,5];case 4:return this._setLoading(!1),[7];case 5:return[2]}})})},o.prototype._ensureUserEmail=function(){var e;return d(this,void 0,void 0,function(){var t,a,i,r;return l(this,function(o){switch(o.label){case 0:return this._currentUserEmail?[2]:(null===(e=this.context.pageContext.user)||void 0===e?void 0:e.email)?(this._currentUserEmail=this.context.pageContext.user.email,this._logDebug("Using pageContext user email",this._currentUserEmail),[2]):(t="".concat(this.context.pageContext.web.absoluteUrl,"/_api/web/currentuser"),this._logDebug("GET current user",t),[4,this.context.spHttpClient.get(t,n.SPHttpClient.configurations.v1,{headers:{Accept:"application/json;odata.metadata=none"}})]);case 1:return(a=o.sent()).ok?[3,3]:[4,a.text()];case 2:throw i=o.sent(),this._logDebug("Error response from currentuser",{status:a.status,body:i}),new Error("Unable to get current user. Status: ".concat(a.status,". Body: ").concat(i));case 3:return[4,a.json()];case 4:return r=o.sent(),this._currentUserEmail=r.Email,this._logDebug("Resolved current user email",this._currentUserEmail),[2]}})})},o.prototype._checkSubscription=function(){return d(this,void 0,void 0,function(){var e,t;return l(this,function(n){switch(n.label){case 0:return[4,this._getSubscriptionItem()];case 1:return e=n.sent(),this._logDebug("Loaded subscription item",e),e&&this.properties.ProductName?(t=e.SubscribedFor||[],this._isSubscribed=t.indexOf(this.properties.ProductName)>-1):this._isSubscribed=!1,this.render(),[2]}})})},o.prototype._subscribe=function(){return d(this,void 0,void 0,function(){var e,t,n,a,i;return l(this,function(r){switch(r.label){case 0:this._setLoading(!0),r.label=1;case 1:if(r.trys.push([1,8,,9]),!(e=this.properties.ProductName))throw new Error("ProductName is not configured.");return[4,this._getSubscriptionItem()];case 2:return(t=r.sent())?[3,4]:(this._logDebug("No existing subscription item, creating new"),[4,this._createSubscriptionItem(e)]);case 3:return r.sent(),[3,7];case 4:return-1!==(n=t.SubscribedFor||[]).indexOf(e)?[3,6]:((a=n.slice()).push(e),this._logDebug("Updating existing item with new product",{id:t.Id,updated:a}),[4,this._updateSubscriptionItem(t.Id,a)]);case 5:return r.sent(),[3,7];case 6:return this._isSubscribed=!0,this._showSuccess("Already subscribed to ".concat(e)),this.render(),this._setLoading(!1),[2];case 7:return this._isSubscribed=!0,this._showSuccess("Successfully subscribed to ".concat(e,"!")),this.render(),[3,9];case 8:return i=r.sent(),this._showError("Error subscribing: "+(null==i?void 0:i.message)),[3,9];case 9:return this._setLoading(!1),[2]}})})},o.prototype._unsubscribe=function(){return d(this,void 0,void 0,function(){var e,t,n,a,i;return l(this,function(r){switch(r.label){case 0:this._setLoading(!0),r.label=1;case 1:if(r.trys.push([1,4,,5]),!(e=this.properties.ProductName))throw new Error("ProductName is not configured.");return[4,this._getSubscriptionItem()];case 2:return(t=r.sent())?(n=t.SubscribedFor||[],a=n.filter(function(t){return t!==e}),this._logDebug("Updating item for unsubscribe",{id:t.Id,current:n,remaining:a}),[4,this._updateSubscriptionItem(t.Id,a)]):(this._isSubscribed=!1,this.render(),this._showSuccess("Successfully unsubscribed from ".concat(e)),this._setLoading(!1),[2]);case 3:return r.sent(),this._isSubscribed=!1,this._showSuccess("Successfully unsubscribed from ".concat(e)),this.render(),[3,5];case 4:return i=r.sent(),this._showError("Error unsubscribing: "+(null==i?void 0:i.message)),[3,5];case 5:return this._setLoading(!1),[2]}})})},o.prototype._getSubscriptionItem=function(){return d(this,void 0,void 0,function(){var e,t,a,i,r,o,s,c,d,u;return l(this,function(l){switch(l.label){case 0:if(!(e=this.properties.ListName))throw new Error("ListName is not configured.");return t=this._currentUserEmail,a="".concat(this.context.pageContext.web.absoluteUrl)+"/_api/web/lists/getbytitle('".concat(e,"')/items")+"?$filter=SubscribedBy eq '".concat(t,"'")+"&$select=Id,Title,SubscribedBy,SubscribedFor,Subscribe,SubscribeOn",this._logDebug("GET subscription item",a),[4,this.context.spHttpClient.get(a,n.SPHttpClient.configurations.v1,{headers:{Accept:"application/json;odata.metadata=none"}})];case 1:return(i=l.sent()).ok?[3,3]:[4,i.text()];case 2:if(r=l.sent(),this._logDebug("Error from GET subscription item",{status:i.status,body:r}),404===i.status)throw new Error("List not found. Body: "+r);throw new Error("Failed to get subscription item. Status: ".concat(i.status,". Body: ").concat(r));case 3:return[4,i.json()];case 4:return o=l.sent(),(s=o.value&&o.value[0]||null)?(c=s.SubscribedFor,d=[],Array.isArray(c)?d=c:c&&Array.isArray(c.results)&&(d=c.results),u={Id:s.Id,Title:s.Title,SubscribedBy:s.SubscribedBy,Subscribe:s.Subscribe,SubscribeOn:s.SubscribeOn,SubscribedFor:d},this._logDebug("Parsed subscription item",u),[2,u]):[2,null]}})})},o.prototype._createSubscriptionItem=function(e){return d(this,void 0,void 0,function(){var t,a,i,r,o,s;return l(this,function(c){switch(c.label){case 0:if(!(t=this.properties.ListName))throw new Error("ListName is not configured.");return a={Title:this._currentUserEmail,SubscribedBy:this._currentUserEmail,Subscribe:"Yes",SubscribeOn:(new Date).toISOString(),SubscribedFor:[e]},i="".concat(this.context.pageContext.web.absoluteUrl)+"/_api/web/lists/getbytitle('".concat(t,"')/items"),this._logDebug("POST create subscription item",{url:i,body:a}),[4,this.context.spHttpClient.post(i,n.SPHttpClient.configurations.v1,{headers:{Accept:"application/json;odata.metadata=none","Content-Type":"application/json;odata.metadata=none"},body:JSON.stringify(a)})];case 1:return(r=c.sent()).ok?[3,3]:[4,r.text()];case 2:throw o=c.sent(),this._logDebug("Error from POST create item",{status:r.status,body:o}),new Error("Failed to create subscription item. Status: ".concat(r.status,". Body: ").concat(o));case 3:return[4,r.json()];case 4:return s=c.sent(),this._logDebug("Created subscription item",s),[2]}})})},o.prototype._updateSubscriptionItem=function(e,t){return d(this,void 0,void 0,function(){var a,i,r,o,s;return l(this,function(c){switch(c.label){case 0:if(!(a=this.properties.ListName))throw new Error("ListName is not configured.");return i={SubscribeOn:(new Date).toISOString(),Subscribe:t.length>0?"Yes":"No",SubscribedFor:t},r="".concat(this.context.pageContext.web.absoluteUrl)+"/_api/web/lists/getbytitle('".concat(a,"')/items(").concat(e,")"),this._logDebug("POST update subscription item",{url:r,body:i}),[4,this.context.spHttpClient.post(r,n.SPHttpClient.configurations.v1,{headers:{Accept:"application/json;odata.metadata=none","Content-Type":"application/json;odata.metadata=none","IF-MATCH":"*","X-HTTP-Method":"MERGE"},body:JSON.stringify(i)})];case 1:return(o=c.sent()).ok?[3,3]:[4,o.text()];case 2:throw s=c.sent(),this._logDebug("Error from POST update item",{status:o.status,body:s}),new Error("Failed to update subscription item. Status: ".concat(o.status,". Body: ").concat(s));case 3:return this._logDebug("Update subscription item OK"),[2]}})})},o.prototype._loadProductNameChoices=function(){return d(this,void 0,void 0,function(){var e,t,a,i,r,o,s,c,d;return l(this,function(l){switch(l.label){case 0:if(e=this.properties.ListName,t=this.properties.ProductNameColumnName,!e||!t)return this._logDebug("List name or column name not configured",{list:e,columnName:t}),[2,[]];l.label=1;case 1:return l.trys.push([1,6,,7]),a="".concat(this.context.pageContext.web.absoluteUrl)+"/_api/web/lists/getbytitle('".concat(e,"')/fields")+"?$filter=EntityPropertyName eq '".concat(t,"'")+"&$select=Choices,TypeAsString",this._logDebug("GET field choices",a),[4,this.context.spHttpClient.get(a,n.SPHttpClient.configurations.v1,{headers:{Accept:"application/json;odata.metadata=minimal"}})];case 2:return(i=l.sent()).ok?[3,4]:[4,i.text()];case 3:throw r=l.sent(),this._logDebug("Error from GET field choices",{status:i.status,body:r}),new Error("Failed to get field choices. Status: ".concat(i.status));case 4:return[4,i.json()];case 5:return(o=l.sent()).value&&0!==o.value.length?(s=o.value[0],c=s.Choices||[],this._logDebug("Loaded choices",c),[2,c.map(function(e){return{key:e,text:e}})]):(this._logDebug("Field not found",t),[2,[]]);case 6:return d=l.sent(),this._logDebug("Error loading product name choices",d),[2,[]];case 7:return[2]}})})},o.prototype._setLoading=function(e){this._isLoading=e,this.render()},o.prototype._showSuccess=function(e){var t=this;this._statusType="success",this._statusMessage=e,this.render(),setTimeout(function(){t._statusMessage="",t._statusType="",t.render()},5e3)},o.prototype._showError=function(e){this._statusType="error",this._statusMessage=e,this.render()},o.prototype._getHtml=function(){var e=this.properties.ProductName||"",t=this.properties.PrefixText||"Subscribe to",n=this.properties.SuffixText||"updates",i=this._isSubscribed?"Unsubscribe from ".concat(e):"".concat(t," ").concat(e," ").concat(n).replace(/\s+/g," ").trim(),o=this._isSubscribed?"buttonSecondary_42f44968":"buttonPrimary_42f44968",s=!!this._statusType,c="success"===this._statusType,d='<svg class="'.concat(a,'" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>\n      <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>\n    </svg>'),l='<svg class="'.concat(a,'" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>\n      <path d="M18.63 13A17.89 17.89 0 0 1 18 8"></path>\n      <path d="M6.26 6.26A5.86 5.86 0 0 0 6 8c0 7-3 9-3 9h14"></path>\n      <path d="M18 8a6 6 0 0 0-9.33-5"></path>\n      <line x1="1" y1="1" x2="23" y2="23"></line>\n    </svg>'),u='<svg class="'.concat("iconSmall_42f44968",'" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">\n      <polyline points="20 6 9 17 4 12"></polyline>\n    </svg>');return'\n      <div class="'.concat("subscribePortalUpdate_42f44968",'">\n        ').concat(s?'\n          <div class="'.concat("alert_42f44968"," ").concat(c?"alertSuccess_42f44968":"alertError_42f44968",'">\n            <div class="').concat("alertContent_42f44968",'">\n              <div class="').concat("alertIcon_42f44968",'">\n                ').concat(c?u:"âš ",'\n              </div>\n              <span class="').concat("alertMessage_42f44968",'">').concat((0,r.escape)(this._statusMessage),'</span>\n            </div>\n            <button class="').concat("alertClose_42f44968",'" id="closeAlert" type="button" aria-label="Close alert">\n              ').concat('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <line x1="18" y1="6" x2="6" y2="18"></line>\n      <line x1="6" y1="6" x2="18" y2="18"></line>\n    </svg>',"\n            </button>\n          </div>\n        "):"",'\n\n        <div class="').concat("card_42f44968",'">\n          <div class="').concat("cardHeader_42f44968",'">\n            <div class="').concat("iconWrapper_42f44968",'">\n              ').concat(this._isSubscribed?d:l,'\n            </div>\n            <div class="').concat("headerContent_42f44968",'">\n              <h3 class="').concat("title_42f44968",'">\n                ').concat((0,r.escape)(e||"Product Updates"),"\n              </h3>\n              ").concat(this.properties.Description?'\n                <p class="'.concat("description_42f44968",'">\n                  ').concat((0,r.escape)(this.properties.Description),"\n                </p>\n              "):"",'\n            </div>\n          </div>\n\n          <div class="').concat("cardBody_42f44968",'">\n            ').concat(this._isSubscribed?'\n              <div class="'.concat("statusBadge_42f44968"," ").concat("statusActive_42f44968",'">\n                ').concat(u,"\n                <span>Subscribed</span>\n              </div>\n            "):"",'\n\n            <button \n              id="toggleBtn"\n              type="button"\n              class="').concat("button_42f44968"," ").concat(o,'"\n              ').concat(this._isLoading?"disabled":"",'\n              aria-busy="').concat(this._isLoading,'"\n            >\n              ').concat(this._isLoading?'\n                <span class="'.concat("spinner_42f44968",'"></span>\n                <span>Processing...</span>\n              '):'\n                <span class="'.concat("buttonText_42f44968",'">').concat((0,r.escape)(i),"</span>\n              "),"\n            </button>\n          </div>\n        </div>\n      </div>\n    ")},o.prototype._wireEvents=function(){var e=this,t=this.domElement.querySelector("#toggleBtn");t&&t.addEventListener("click",function(){e._isLoading||(e._isSubscribed?e._unsubscribe():e._subscribe())});var n=this.domElement.querySelector("#closeAlert");n&&n.addEventListener("click",function(){e._statusMessage="",e._statusType="",e.render()})},Object.defineProperty(o.prototype,"dataVersion",{get:function(){return e.Version.parse("1.0")},enumerable:!1,configurable:!0}),o.prototype.onPropertyPaneConfigurationStart=function(){return d(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return this._productNameOptionsLoaded?[3,2]:(this.context.propertyPane.refresh(),e=this,[4,this._loadProductNameChoices()]);case 1:e._productNameOptions=t.sent(),this._productNameOptionsLoaded=!0,this.context.propertyPane.refresh(),t.label=2;case 2:return[2]}})})},o.prototype.onPropertyPaneFieldChanged=function(e,t,n){var a=this;"ListName"!==e&&"ProductNameColumnName"!==e||(this._productNameOptionsLoaded=!1,this._productNameOptions=[],this._loadProductNameChoices().then(function(e){a._productNameOptions=e,a._productNameOptionsLoaded=!0,a.context.propertyPane.refresh()})),i.prototype.onPropertyPaneFieldChanged.call(this,e,t,n)},o.prototype.getPropertyPaneConfiguration=function(){return{pages:[{header:{description:"Subscribe Portal Update Settings"},groups:[{groupName:"List Configuration",groupFields:[(0,t.PropertyPaneTextField)("ListName",{label:"List Name",description:'Default: "subscriptionlist"'}),(0,t.PropertyPaneTextField)("ProductNameColumnName",{label:"Product Name Column",description:'The internal name of the multi-choice column (Default: "SubscribedFor")'})]},{groupName:"Product Selection",groupFields:[(0,t.PropertyPaneDropdown)("ProductName",{label:"Product Name",options:this._productNameOptions,disabled:!this._productNameOptionsLoaded||0===this._productNameOptions.length})]},{groupName:"Display Settings",groupFields:[(0,t.PropertyPaneTextField)("Description",{label:"Description",multiline:!0}),(0,t.PropertyPaneTextField)("PrefixText",{label:"Button Prefix Text",description:'Default: "Subscribe to"'}),(0,t.PropertyPaneTextField)("SuffixText",{label:"Button Suffix Text",description:'Default: "updates"'})]}]}]}},o}(t.BaseClientSideWebPart)})(),s})());